<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>一个人的小世界</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/github.css">
<meta name="generator" content="Hexo 7.3.0"></head>
<body>
  <header>
    <h1><a href="https://haixuxu.github.io">一个人的小世界</a></h1>
    <nav>
      
        <a href="/">Home</a>
      
        <a href="/archives">Archives</a>
      
    </nav>
  </header>
  <main>
    <article>
    <h2>mybatis使用入门</h2>
    <p>2016-10-24</p>
    <div class="post-content">
      <h3 id="mybatis使用入门"><a href="#mybatis使用入门" class="headerlink" title="mybatis使用入门"></a>mybatis使用入门</h3><p>1.编写全局配置文件configuration.xml</p>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">configuration</span></span>
<span class="hljs-meta">    <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span>
<span class="hljs-meta">    <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span>
        <span class="hljs-comment">&lt;!--给实体类起一个别名 user --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">typeAlias</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cn.sky.bookshop.beans.User&quot;</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;User&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span>
    <span class="hljs-comment">&lt;!--数据源配置  这块用 mysql数据库 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;jdbc&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/ibatis&quot;</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;215890&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span>
        <span class="hljs-comment">&lt;!--userMapper.xml装载进来  同等于把“dao”的实现装载进来 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;User.xml&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;UserMapper.xml&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre>
<p>2.这里编写一个MyBatis工具类</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.sky.bookshop.utils;
<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> org.apache.ibatis.io.Resources;
<span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSession;
<span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;
<span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBatisUtil</span> &#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SqlSessionFactory sessionFactory;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;configuration.xml&quot;</span>;

    <span class="hljs-keyword">static</span> &#123;
    <span class="hljs-keyword">try</span> &#123;
        sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>()<span class="hljs-comment">//</span>
                .build(Resources<span class="hljs-comment">//</span>
            .getResourceAsReader(resource));
        <span class="hljs-comment">// sessionFactory.getConfiguration().addMapper(UserDao.class);</span>
    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
        e.printStackTrace();
    &#125;
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SqlSession <span class="hljs-title function_">getSqlSession</span><span class="hljs-params">()</span> &#123;
    <span class="hljs-keyword">return</span> sessionFactory.openSession();
    &#125;
&#125;</code></pre>
<p>然后接可以先建立一个测试类加载测试一番了。。</p>
<p>3.按Javabean规范写的一个User类</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.sky.bookshop.beans;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;
    <span class="hljs-keyword">private</span> String userName;
    <span class="hljs-keyword">private</span> String password;
    <span class="hljs-keyword">private</span> String email;

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;
        <span class="hljs-keyword">return</span> id;
    &#125;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> &#123;
        <span class="hljs-built_in">this</span>.id = id;
    &#125;

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> &#123;
        <span class="hljs-keyword">return</span> password;
    &#125;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPassword</span><span class="hljs-params">(String password)</span> &#123;
        <span class="hljs-built_in">this</span>.password = password;
    &#125;
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getEmail</span><span class="hljs-params">()</span> &#123;
        <span class="hljs-keyword">return</span> email;
    &#125;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setEmail</span><span class="hljs-params">(String email)</span> &#123;
        <span class="hljs-built_in">this</span>.email = email;
    &#125;
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserName</span><span class="hljs-params">()</span> &#123;
        <span class="hljs-keyword">return</span> userName;
    &#125;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserName</span><span class="hljs-params">(String userName)</span> &#123;
        <span class="hljs-built_in">this</span>.userName = userName;
    &#125;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;
    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User [email=&quot;</span> + email + <span class="hljs-string">&quot;, id=&quot;</span> + id + <span class="hljs-string">&quot;, password=&quot;</span> + password
        + <span class="hljs-string">&quot;, username=&quot;</span> + userName + <span class="hljs-string">&quot;]&quot;</span>;
    &#125;
&#125;</code></pre>

<p>4.这里将UserDao接口命名为UserMapper接口</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.sky.bookshop.dao;

<span class="hljs-keyword">import</span> cn.sky.bookshop.beans.User;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;


    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findUserByName</span><span class="hljs-params">(String username)</span><span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertUser</span><span class="hljs-params">(User user)</span><span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">(User user)</span><span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUserById</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span><span class="hljs-keyword">throws</span> Exception;
&#125;</code></pre>

<p>5.关键是这里的UserMapper.xml</p>
<pre><code class="hljs java">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;
 &lt;!DOCTYPE mapper PUBLIC <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;

&lt;!-- namespace必须是定义的接口全限定名 --&gt;
&lt;mapper namespace=<span class="hljs-string">&quot;cn.sky.bookshop.dao.UserMapper&quot;</span>&gt;
    &lt;!-- 里面id是接口的方法名 parameterType是接口里方法的传入参数 --&gt;
    &lt;insert id=<span class="hljs-string">&quot;insertUser&quot;</span> parameterType=<span class="hljs-string">&quot;User&quot;</span>&gt;
        insert into
        <span class="hljs-title function_">t_user</span><span class="hljs-params">(id,username,password,email)</span>values(#&#123;id&#125;,#&#123;userName&#125;,#&#123;password&#125;,#&#123;email&#125;);
    &lt;/insert&gt;
    &lt;!-- resultType这里是接口里方法返回值类型：当方法返回集合时，这里还是设为集合元素类型 --&gt;
    &lt;select id=<span class="hljs-string">&quot;findUserByName&quot;</span> parameterType=<span class="hljs-string">&quot;string&quot;</span> resultType=<span class="hljs-string">&quot;User&quot;</span>&gt;
        select * from t_user where username=#&#123;userName&#125;;
    &lt;/select&gt;

    &lt;update id=<span class="hljs-string">&quot;updateUser&quot;</span> parameterType=<span class="hljs-string">&quot;User&quot;</span>&gt;
        update t_user set
        username=#&#123;userName&#125;,password=#&#123;password&#125;,email=#&#123;email&#125; where
        id=#&#123;id&#125;;
    &lt;/update&gt;

    &lt;delete id=<span class="hljs-string">&quot;deleteUserById&quot;</span> parameterType=<span class="hljs-string">&quot;int&quot;</span>&gt;
        delete from t_user
        where id=#&#123;id&#125;;
    &lt;/delete&gt;
&lt;/mapper&gt;
</code></pre>

<p>6.注意：上面的步骤配置有些严格。。因为下面的接口动态代理对象（就是个接口的实现）是根据UserMapper接口和UserMapper.xml文件生成的! 下面是我的DAO测试类</p>
<pre><code class="hljs java">UserMapperTest
<span class="hljs-keyword">package</span> cn.sky.bookshop.test;

<span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSession;

<span class="hljs-keyword">import</span> cn.sky.bookshop.beans.User;
<span class="hljs-keyword">import</span> cn.sky.bookshop.dao.UserMapper;
<span class="hljs-keyword">import</span> cn.sky.bookshop.utils.MyBatisUtil;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserMapperTest</span> &#123;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> args</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;
<span class="hljs-comment">//      addUserMapper(); 添加</span>
<span class="hljs-comment">//  findUserMapper(); 查找</span>
<span class="hljs-comment">//  updateUserMapper();更新</span>
    deleteUserMapper();
    &#125;
    <span class="hljs-comment">//添加记录</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addUserMapper</span><span class="hljs-params">()</span>&#123;
    <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> MyBatisUtil.getSqlSession();
    <span class="hljs-comment">//获取接口的动态代理对象</span>
    <span class="hljs-type">UserMapper</span> <span class="hljs-variable">um</span> <span class="hljs-operator">=</span> sqlSession.getMapper(UserMapper.class);
    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
    user.setUserName(<span class="hljs-string">&quot;大侠&quot;</span>);
    user.setPassword(<span class="hljs-string">&quot;daxia&quot;</span>);
    user.setEmail(<span class="hljs-string">&quot;fdasf@qq.com2&quot;</span>);
    <span class="hljs-keyword">try</span> &#123;
        um.insertUser(user);
    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
        e.printStackTrace();
    &#125;
    sqlSession.commit();
    sqlSession.close();

    &#125;
    <span class="hljs-comment">//查找记录</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findUserMapper</span><span class="hljs-params">()</span> &#123;
    <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> MyBatisUtil.getSqlSession();
    <span class="hljs-type">UserMapper</span> <span class="hljs-variable">um</span> <span class="hljs-operator">=</span> sqlSession.getMapper(UserMapper.class);
    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">try</span> &#123;
        user = um.findUserByName(<span class="hljs-string">&quot;大侠&quot;</span>);
    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
        e.printStackTrace();
    &#125;
    System.out.println(user);
    sqlSession.close();
    &#125;
    <span class="hljs-comment">//跟新纪录</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUserMapper</span><span class="hljs-params">()</span>&#123;
    <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> MyBatisUtil.getSqlSession();
    <span class="hljs-type">UserMapper</span> <span class="hljs-variable">um</span> <span class="hljs-operator">=</span> sqlSession.getMapper(UserMapper.class);
    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
    user.setId(<span class="hljs-number">4</span>);
    user.setUserName(<span class="hljs-string">&quot;小虾&quot;</span>);
    user.setPassword(<span class="hljs-string">&quot;xiaoxia&quot;</span>);
    user.setEmail(<span class="hljs-string">&quot;xiaoxiao@qq.com2&quot;</span>);
    <span class="hljs-keyword">try</span> &#123;
        um.updateUser(user);
    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
        e.printStackTrace();
    &#125;
    sqlSession.commit();
    sqlSession.close();
    &#125;
    <span class="hljs-comment">//删除记录</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUserMapper</span><span class="hljs-params">()</span>&#123;
    <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> MyBatisUtil.getSqlSession();
    <span class="hljs-type">UserMapper</span> <span class="hljs-variable">um</span> <span class="hljs-operator">=</span> sqlSession.getMapper(UserMapper.class);
    <span class="hljs-keyword">try</span> &#123;
        um.deleteUserById(<span class="hljs-number">4</span>);
    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
        e.printStackTrace();
    &#125;
    sqlSession.commit();
    sqlSession.close();
    &#125;
&#125;</code></pre>
    </div>
  </article>
  
  
  </main>
  <footer>
    <p>&copy; 2024 xuxihai</p>
  </footer>

  <!-- 引入 Clipboard.js -->
  <script src="https://cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script>
  <script src="/js/linenumber.js"></script>
  <script src="/js/copy.js"></script>
</body>
</html>

